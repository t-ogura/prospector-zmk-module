# Copyright (c) 2026 The ZMK Contributors
# SPDX-License-Identifier: MIT

if SHIELD_SCANNER_POCKET

config ZMK_KEYBOARD_NAME
    default "ScanPocket"

# ===== ディスプレイ基本設定 =====
config ZMK_DISPLAY
    default y

config DISPLAY
    default y

config SPI
    default y

# ===== LVGL モノクロ設定 (LS013B7DH05: 144x168, 1bit) =====
config LVGL
    default y

# VDB (Virtual Display Buffer) - 100% full frame
config LV_Z_VDB_SIZE
    default 100

# Disable double buffering to save memory for objects
config LV_Z_DOUBLE_VDB
    default n

# Keep monochrome conversion buffer enabled (default)
# config LV_Z_MONOCHROME_CONVERSION_BUFFER - use default

config LV_DPI_DEF
    default 161

config LV_Z_BITS_PER_PIXEL
    default 1

choice LV_COLOR_DEPTH
    default LV_COLOR_DEPTH_1
endchoice

# Memory pool - need space for widget metadata, styles, rendering buffers
# LVGL uses 8-bit colors internally, converts to 1-bit on flush
# Testing with 128KB to support more objects
config LV_Z_MEM_POOL_SIZE
    default 131072

# ===== LVGL ウィジェット =====
choice ZMK_DISPLAY_STATUS_SCREEN
    default ZMK_DISPLAY_STATUS_SCREEN_CUSTOM
endchoice

config ZMK_DISPLAY_STATUS_SCREEN_CUSTOM
    select LV_USE_LABEL
    select LV_USE_IMG
    select LV_USE_CANVAS
    select LV_USE_BAR

choice ZMK_DISPLAY_WORK_QUEUE
    default ZMK_DISPLAY_WORK_QUEUE_DEDICATED
endchoice

# Increased stack sizes for stable LVGL rendering
config ZMK_DISPLAY_DEDICATED_THREAD_STACK_SIZE
    default 8192

config MAIN_STACK_SIZE
    default 8192

# ===== スキャナー機能 =====
config PROSPECTOR_MODE_SCANNER
    default y

config BT_OBSERVER
    default y

# Scanner Pocket has no touch panel (Memory LCD only)
config PROSPECTOR_TOUCH_ENABLED
    default n

# ===== 省電力設定 =====
# Memory LCD は常時表示でも超低消費電力（60μW）
config ZMK_DISPLAY_BLANK_ON_IDLE
    default n

# ===== Scanner Pocket 固有設定 =====
config SCANNER_POCKET_WIDGET_STATUS
    bool "Scanner Pocket status widget"
    default y
    select LV_USE_LABEL
    select LV_USE_IMG
    help
      Enable the Scanner Pocket status widget for monochrome display.

config SCANNER_POCKET_INVERT_COLORS
    bool "Invert display colors (white text on black background)"
    default y
    help
      When enabled, display uses black background with white text.
      When disabled, display uses white background with black text.

config SCANNER_POCKET_LANDSCAPE
    bool "Use landscape orientation (168x144 instead of 144x168)"
    default y  # Custom rotated driver for landscape
    help
      When enabled, display is rotated 90 degrees for landscape mode.
      Uses custom rotated driver instead of default ls0xx driver.
      Landscape: 168 wide x 144 tall (good for battery bars)
      Portrait: 144 wide x 168 tall

# Disable default ls0xx driver when using rotated driver
config LS0XX
    default n if SCANNER_POCKET_LANDSCAPE

endif # SHIELD_SCANNER_POCKET
